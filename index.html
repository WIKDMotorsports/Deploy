<!-- 
  Instructions for Shopify:
  1. Go to your Shopify Admin > Online Store > Theme editor.
  2. Add a new "Custom Liquid" section to your homepage.
  3. Delete any default code in the Custom Liquid block.
  4. Copy and paste ALL of the code below into the block.
  5. In the section settings on the right, set "Content width" to "Full width" and "Section padding" to "0px" for top and bottom.
  6. Click "Save".
-->

<!-- 1. FONT STYLES (Required) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<!-- 2. CSS STYLES (Required) -->
<style>
    /* --- BASE VARIABLES --- */
    :root {
        --color-background: #0A0A0A;
        --color-text: #EAEAEA;
        --color-text-muted: #888888;
        --color-primary: #FF3B30;
        --color-surface: #141414;
        --color-border: #2A2A2A;
        --font-heading: 'Rajdhani', sans-serif;
        --font-body: 'Inter', sans-serif;
    }

    /* --- SCOPED STYLES FOR SHOPIFY --- */
    #wikd-homepage-root {
        background-color: var(--color-background);
        color: var(--color-text);
        font-family: var(--font-body);
        line-height: 1.6;
        overflow-x: hidden;
        margin-left: calc(-1 * var(--page-width-margin, 0px));
        margin-right: calc(-1 * var(--page-width-margin, 0px));
    }

    #wikd-homepage-root *, 
    #wikd-homepage-root *::before, 
    #wikd-homepage-root *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    #wikd-homepage-root h1, 
    #wikd-homepage-root h2, 
    #wikd-homepage-root h3 {
        font-family: var(--font-heading);
        font-weight: 700;
        line-height: 1.2;
        text-transform: uppercase;
    }

    #wikd-homepage-root img, 
    #wikd-homepage-root video, 
    #wikd-homepage-root iframe {
        max-width: 100%;
        height: auto;
        display: block;
    }

    #wikd-homepage-root a {
        color: var(--color-primary);
        text-decoration: none;
    }

    #wikd-homepage-root .section {
        padding: 60px 5%;
        overflow: hidden;
    }

    #wikd-homepage-root .container {
        max-width: 1400px;
        margin: 0 auto;
    }
    
    #wikd-homepage-root .section-title {
        text-align: center;
        font-size: clamp(2.5rem, 6vw, 4rem);
        margin-bottom: 60px;
    }

    /* --- HERO SLIDESHOW SECTION (REPLACED FROM REFERENCE) --- */
    #wikd-homepage-root .hero {
        padding-top: 80px;
        padding-bottom: 50px;
        padding-left: 5%;
        padding-right: 5%;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #wikd-homepage-root .hero-wrapper {
        position: relative;
        width: 100%;
        max-width: 1400px;
        aspect-ratio: 16 / 7;
        border-radius: 16px;
        transition: box-shadow 0.8s ease-in-out;
    }

    #wikd-homepage-root .hero-wrapper.theme-exhaust { box-shadow: 0 0 60px -10px #8A2BE2; }
    #wikd-homepage-root .hero-wrapper.theme-packages { box-shadow: 0 0 60px -10px #ff1a00; }
    #wikd-homepage-root .hero-wrapper.theme-wheels { box-shadow: 0 0 60px -10px #008000; }
    #wikd-homepage-root .hero-wrapper.theme-cooling { box-shadow: 0 0 60px -10px #00c5ff; }

    #wikd-homepage-root .slideshow-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 16px;
        overflow: hidden;
        z-index: 1;
        background: #000;
    }

    #wikd-homepage-root .slideshow-container::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 16px;
        padding: 2px;
        background-size: 300%;
        animation: colorFlow 4s ease-in-out infinite;
        -webkit-mask:
            linear-gradient(#fff 0 0) content-box,
            linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        z-index: 4;
        pointer-events: none;
        transition: background-image 0.8s ease-in-out;
    }

    #wikd-homepage-root .slide {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.8s ease-in-out, visibility 0.8s;
        z-index: 1;
    }
    
    #wikd-homepage-root .slide-content {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        z-index: 3;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        align-items: flex-start;
        text-align: left;
        padding: 40px;
        height: 100%;
    }
    
    #wikd-homepage-root .slide-content::after {
        content: '';
        position: absolute;
        bottom: 0; left: 0; width: 100%; height: 70%;
        background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%);
        z-index: -1;
    }

    #wikd-homepage-root .slide-background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 1;
    }

    #wikd-homepage-root video.slide-background {
        object-fit: contain;
    }
    
    #wikd-homepage-root .slide.active {
        opacity: 1;
        visibility: visible;
    }

    #wikd-homepage-root .slide-title-group {
        display: flex;
        align-items: center;
        gap: 2rem;
        transform: translateY(30px);
        opacity: 0;
    }

    #wikd-homepage-root .slide h1 {
        font-weight: 700;
        font-size: clamp(2rem, 5vw, 3.5rem);
        background-size: 300%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: colorFlow 4s ease-in-out infinite;
        margin: 0;
        transition: background-image 0.8s ease-in-out;
    }
    
    #wikd-homepage-root .slide.active .slide-title-group {
        transform: translateY(0);
        opacity: 1;
        transition: transform 0.8s cubic-bezier(0.165, 0.84, 0.44, 1) 0.3s, opacity 0.8s ease 0.3s;
    }

    @keyframes colorFlow {
        0%   { background-position: 0% 50%; }
        50%  { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    #wikd-homepage-root .slideshow-container.theme-exhaust::before,
    #wikd-homepage-root .slideshow-container.theme-exhaust .slide.active h1 {
        background-image: linear-gradient(90deg, #4B0082, #800000, #8A2BE2, #800000, #4B0082);
    }
    #wikd-homepage-root .slideshow-container.theme-packages::before,
    #wikd-homepage-root .slideshow-container.theme-packages .slide.active h1 {
        background-image: linear-gradient(90deg, #b30000, #ff1a00, #ffaa00, #ff1a00, #b30000);
    }
    #wikd-homepage-root .slideshow-container.theme-wheels::before,
    #wikd-homepage-root .slideshow-container.theme-wheels .slide.active h1 {
        background-image: linear-gradient(90deg, #004d00, #008000, #90ee90, #008000, #004d00);
    }
    #wikd-homepage-root .slideshow-container.theme-cooling::before,
    #wikd-homepage-root .slideshow-container.theme-cooling .slide.active h1 {
        background-image: linear-gradient(90deg, #00c5ff, #ffffff, #afeeee, #ffffff, #00c5ff);
    }

    #wikd-homepage-root .btn {
        display: inline-block;
        padding: 14px 32px;
        font-family: var(--font-heading);
        font-size: 18px;
        font-weight: 600;
        text-transform: uppercase;
        color: var(--color-text);
        background-color: transparent;
        border: 2px solid var(--color-border);
        position: relative;
        overflow: hidden;
        transition: color 0.4s ease-in-out, border-color 0.4s ease-in-out;
        clip-path: polygon(0 0, 100% 0, 100% 100%, 10px 100%, 0 85%);
        text-decoration: none;
        flex-shrink: 0;
    }
    #wikd-homepage-root .btn span { position: relative; z-index: 2; }
    #wikd-homepage-root .btn::before {
        content: '';
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        z-index: 1;
        transform: translateX(-101%);
        transition: transform 0.5s cubic-bezier(0.7, 0, 0.3, 1), background-color 0.4s ease-in-out;
    }
    #wikd-homepage-root .btn:hover { color: white; }
    #wikd-homepage-root .btn:hover::before { transform: translateX(0); }

    #wikd-homepage-root .slide[data-theme="theme-exhaust"] .btn:hover { border-color: #8A2BE2; }
    #wikd-homepage-root .slide[data-theme="theme-exhaust"] .btn::before { background-color: #8A2BE2; }
    #wikd-homepage-root .slide[data-theme="theme-packages"] .btn:hover { border-color: #ff1a00; }
    #wikd-homepage-root .slide[data-theme="theme-packages"] .btn::before { background-color: #ff1a00; }
    #wikd-homepage-root .slide[data-theme="theme-wheels"] .btn:hover { border-color: #008000; }
    #wikd-homepage-root .slide[data-theme="theme-wheels"] .btn::before { background-color: #008000; }
    #wikd-homepage-root .slide[data-theme="theme-cooling"] .btn:hover { border-color: #00c5ff; }
    #wikd-homepage-root .slide[data-theme="theme-cooling"] .btn::before { background-color: #00c5ff; }

    #wikd-homepage-root .section-cta {
        text-align: center;
        margin-top: 40px;
    }
    #wikd-homepage-root .btn-primary:hover { border-color: var(--color-primary); }
    #wikd-homepage-root .btn-primary::before { background-color: var(--color-primary); }


    #wikd-homepage-root #questionnaire-section { padding-top: 0; padding-bottom: 0; }
    #wikd-homepage-root .questionnaire-iframe {
        border: none;
        width: 100%;
        display: block;
        background-color: transparent;
        transition: height 0.2s ease-out;
    }

    #wikd-homepage-root .packages-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 30px;
    }
    #wikd-homepage-root .package-card {
        position: relative;
        aspect-ratio: 3 / 4;
        overflow: hidden;
        border-radius: 8px;
        border: 1px solid var(--color-border);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: block;
    }
    #wikd-homepage-root .package-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }
    #wikd-homepage-root .package-card-bg {
        position: absolute; inset: 0; width: 100%; height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    #wikd-homepage-root .package-card:hover .package-card-bg { transform: scale(1.05); }
    #wikd-homepage-root .package-card-overlay {
        position: absolute; inset: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, transparent 60%);
        display: flex; flex-direction: column; justify-content: flex-end;
        padding: 25px;
    }
    #wikd-homepage-root .package-card-title {
        font-size: 2rem; color: white;
        transform: translateY(20px); opacity: 0;
        transition: transform 0.4s ease 0.1s, opacity 0.4s ease 0.1s;
    }
    #wikd-homepage-root .package-card-link {
        font-size: 1rem; color: var(--color-primary);
        text-transform: uppercase; font-weight: 600;
        transform: translateY(20px); opacity: 0;
        transition: transform 0.4s ease 0.2s, opacity 0.4s ease 0.2s;
    }
    #wikd-homepage-root .package-card:hover .package-card-title,
    #wikd-homepage-root .package-card:hover .package-card-link {
        transform: translateY(0);
        opacity: 1;
    }

    #wikd-homepage-root .ticker-section { padding: 60px 0; }
    #wikd-homepage-root .ticker-wrap {
        max-width: 1400px; margin: 0 auto; width: 100%;
        overflow: hidden; position: relative;
    }
    #wikd-homepage-root .ticker-wrap::before, 
    #wikd-homepage-root .ticker-wrap::after {
        content: ''; position: absolute; top: 0;
        width: 100px; height: 100%; z-index: 2;
    }
    #wikd-homepage-root .ticker-wrap::before { left: 0; background: linear-gradient(to right, var(--color-background) 0%, transparent 100%); }
    #wikd-homepage-root .ticker-wrap::after { right: 0; background: linear-gradient(to left, var(--color-background) 0%, transparent 100%); }
    #wikd-homepage-root .ticker-move { display: inline-flex; animation: ticker 60s linear infinite; }
    #wikd-homepage-root .exhaust-card {
        display: flex; flex-direction: column;
        background-color: var(--color-surface);
        border-radius: 8px; border: 1px solid var(--color-border);
        overflow: hidden; transition: transform 0.3s ease, box-shadow 0.3s ease;
        text-decoration: none; color: var(--color-text);
        width: 380px; margin: 0 20px; flex-shrink: 0;
    }
    #wikd-homepage-root .exhaust-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
    #wikd-homepage-root .exhaust-card-image-wrapper { position: relative; aspect-ratio: 16 / 9; overflow: hidden; }
    #wikd-homepage-root .exhaust-card-bg { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s cubic-bezier(0.3, 1, 0.4, 1); }
    #wikd-homepage-root .exhaust-card:hover .exhaust-card-bg { transform: scale(1.05); }
    #wikd-homepage-root .exhaust-card-content { padding: 20px; display: flex; flex-direction: column; flex-grow: 1; }
    #wikd-homepage-root .exhaust-card-title { font-size: 1.2rem; line-height: 1.4; margin: 0 0 10px 0; flex-grow: 1; text-transform: none; color: var(--color-text); }
    #wikd-homepage-root .exhaust-card-price { font-size: 1.6rem; font-weight: 700; color: var(--color-primary); margin-top: auto; font-family: var(--font-heading); }
    @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

    #wikd-homepage-root .gallery-grid { 
        display: grid; 
        grid-template-columns: repeat(4, 1fr); 
        gap: 20px; 
    }
    #wikd-homepage-root .gallery-item { overflow: hidden; border-radius: 8px; cursor: pointer; border: 1px solid var(--color-border); }
    #wikd-homepage-root .gallery-item img { transition: transform 0.4s ease; }
    #wikd-homepage-root .gallery-item:hover img { transform: scale(1.05); }

    /* --- MAP & LOCATION SECTION (REPLACED FROM REFERENCE) --- */
    #wikd-homepage-root .map-iframe {
        border: none;
        width: 100%;
        display: block;
        background-color: transparent;
        height: 600px;
        border-radius: 16px;
    }
    
    #wikd-homepage-root .lightbox {
        position: fixed; inset: 0;
        background: rgba(0,0,0,0.9); z-index: 99999;
        display: flex; justify-content: center; align-items: center;
        opacity: 0; pointer-events: none; transition: opacity 0.4s ease;
    }
    #wikd-homepage-root .lightbox.active { opacity: 1; pointer-events: all; }
    #wikd-homepage-root .lightbox-content { position: relative; max-width: 90vw; max-height: 90vh; }
    #wikd-homepage-root .lightbox-content img { max-width: 100%; max-height: 90vh; border-radius: 8px; }
    #wikd-homepage-root .lightbox-close, 
    #wikd-homepage-root .lightbox-prev, 
    #wikd-homepage-root .lightbox-next {
        position: absolute; background: none; border: none;
        color: white; font-size: 3rem; cursor: pointer; z-index: 1;
        transition: color 0.3s ease;
    }
    #wikd-homepage-root .lightbox-close:hover, 
    #wikd-homepage-root .lightbox-prev:hover, 
    #wikd-homepage-root .lightbox-next:hover { color: var(--color-primary); }
    #wikd-homepage-root .lightbox-close { top: 20px; right: 30px; }
    #wikd-homepage-root .lightbox-prev { top: 50%; left: 20px; transform: translateY(-50%); }
    #wikd-homepage-root .lightbox-next { top: 50%; right: 20px; transform: translateY(-50%); }

    /* --- RESPONSIVE STYLES --- */

    @media (max-width: 1200px) {
        #wikd-homepage-root .packages-grid,
        #wikd-homepage-root .gallery-grid { 
            grid-template-columns: repeat(2, 1fr); 
        }
    }

    @media (max-width: 900px) {
        #wikd-homepage-root .hero { padding-top: 100px; }
        #wikd-homepage-root .hero-wrapper, 
        #wikd-homepage-root .slideshow-container { aspect-ratio: 16 / 9; }
        
        #wikd-homepage-root .map-iframe { 
            height: 1000px;
        }
    }

    @media (max-width: 768px) {
        #wikd-homepage-root .section { padding: 40px 5%; }
        #wikd-homepage-root .section-title { margin-bottom: 40px; }
        
        #wikd-homepage-root .hero { 
            padding-top: 80px; 
            padding-bottom: 40px;
        }
        
        #wikd-homepage-root .hero-wrapper { aspect-ratio: 4 / 3; }
        #wikd-homepage-root .slide-content { padding: 25px; }
        #wikd-homepage-root .slide-title-group { flex-direction: column; align-items: flex-start; gap: 1.5rem; }
        #wikd-homepage-root .btn { padding: 12px 28px; font-size: 16px; }

        #wikd-homepage-root .packages-grid { 
            grid-template-columns: repeat(2, 1fr);
            gap: 20px; 
        }
        #wikd-homepage-root .gallery-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        #wikd-homepage-root .package-card { aspect-ratio: 1 / 1; }
        #wikd-homepage-root .package-card-title { font-size: 1.75rem; }
        
        #wikd-homepage-root .ticker-wrap::before, 
        #wikd-homepage-root .ticker-wrap::after { width: 50px; }
        #wikd-homepage-root .exhaust-card { width: 80vw; max-width: 320px; margin: 0 10px; }
        
        #wikd-homepage-root .map-iframe {
            height: 1000px;
        }
    }

    @media (max-width: 480px) {
        #wikd-homepage-root .section { padding: 30px 4%; }
        
        #wikd-homepage-root .hero { 
            padding-left: 4%;
            padding-right: 4%;
        }
        
        #wikd-homepage-root .hero-wrapper { aspect-ratio: 1 / 1; }

        #wikd-homepage-root .slide-content { padding: 20px; }
        #wikd-homepage-root .slide h1 { font-size: clamp(1.8rem, 10vw, 2.5rem); }
        #wikd-homepage-root .btn { padding: 10px 24px; font-size: 15px; }
        
        #wikd-homepage-root .exhaust-card { width: 85vw; margin: 0 8px; }
        #wikd-homepage-root .exhaust-card-title { font-size: 1.1rem; }
        #wikd-homepage-root .exhaust-card-price { font-size: 1.4rem; }
        #wikd-homepage-root .lightbox-close { top: 10px; right: 15px; font-size: 2.5rem; }
        #wikd-homepage-root .lightbox-prev { left: 10px; }
        #wikd-homepage-root .lightbox-next { right: 10px; }
    }
</style>

<!-- 3. HTML CONTENT (Required) -->
<div id="wikd-homepage-root">
    <main>
        <!-- HERO SLIDESHOW SECTION -->
        <section class="hero" id="hero">
            <div class="hero-wrapper">
                <div class="slideshow-container" id="slideshow">
                    <div class="slide" data-theme="theme-exhaust">
                        <video id="exhaust-video" class="slide-background" muted playsinline>
                            <source src="https://github.com/WIKDMotorsports/TestSite/raw/refs/heads/main/5-8mbps.mp4" type="video/mp4">
                        </video>
                        <div class="slide-content">
                            <div class="slide-title-group">
                                <h1>Titanium Exhausts</h1>
                                <a href="#exhausts" class="btn"><span>Explore</span></a>
                            </div>
                        </div>
                    </div>
                    <div class="slide" data-theme="theme-packages">
                        <img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/WIKDonDyno.jpg?v=1752603899" alt="Performance Packages" class="slide-background">
                        <div class="slide-content">
                            <div class="slide-title-group">
                                <h1>Performance Packages</h1>
                                <a href="#packages" class="btn"><span>Explore</span></a>
                            </div>
                        </div>
                    </div>
                    <div class="slide" data-theme="theme-wheels">
                        <img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/f450.jpg?v=1750445422" alt="F-450 Wheel & Tire Package" class="slide-background">
                        <div class="slide-content">
                            <div class="slide-title-group">
                                <h1>F-450 Wheel & Tire</h1>
                                <a href="/pages/f450-wheel-tire-package" class="btn"><span>View Package</span></a>
                            </div>
                        </div>
                    </div>
                    <div class="slide" data-theme="theme-cooling">
                        <iframe class="slide-background" loading="lazy" title="Interactive Cooling Fan" srcdoc='<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Interactive Video</title><style>html,body{height:100%;width:100%;margin:0;padding:0;font-family:Inter,sans-serif;display:flex;justify-content:center;align-items:center;background-color:#000;box-sizing:border-box;overflow:hidden}video{width:100%;height:auto;display:block;cursor:pointer}</style></head><body><video id="interactiveVideo" preload="metadata"><source src="https://github.com/WIKDMotorsports/TestSite/raw/refs/heads/main/FanInteract.mp4" type="video/mp4"></video><script>document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("interactiveVideo"),t=16,o=22,i=4,n=4;let a=0,r=0,s=!1,l=!1,d=null;const c=200;let u=!1,v=!1,m=null;const p=()=>"ontouchstart"in window||navigator.maxTouchPoints>0;function g(){m&&cancelAnimationFrame(m),m=null,v=!1}function y(){g(),v=!0,e.pause();const t=Math.max(0,e.currentTime-n/o);const i=()=>{v&&e.currentTime>t?(e.currentTime=Math.max(0,e.currentTime-1/o),v&&(m=requestAnimationFrame(i))):g()};m=requestAnimationFrame(i)}e.addEventListener("loadedmetadata",()=>{const i=t/o;a=e.duration-i,r=4/o,e.pause(),e.currentTime=0}),p()?(e.addEventListener("touchstart",e=>{l=!0,g(),d=setTimeout(()=>{l&&(e.currentTime=0,u=!0,e.play().catch(e=>{}))},c)}),e.addEventListener("touchend",()=>{clearTimeout(d),l&&(l=!1,u=!1,e.pause(),e.currentTime>0?y():(e.currentTime=0,e.pause()))})):(e.addEventListener("mouseenter",()=>{s=!0,g(),e.currentTime=0,u=!0,e.play().catch(e=>{})}),e.addEventListener("mouseleave",()=>{s=!1,u=!1,e.pause(),e.currentTime>0?y():(e.currentTime=0,e.pause())})),e.addEventListener("timeupdate",()=>{if(v)return;const t=p()?l:s;if(!t||e.paused||0===a)return;u?e.currentTime>=r&&(e.currentTime=a,u=!1):e.currentTime>=e.duration-5/o&&(e.currentTime=a)}),e.addEventListener("ended",()=>{const t=p()?l:s;t&&a>0?(e.currentTime=a,e.play().catch(e=>{})):t||(e.currentTime=0,e.pause())})})<\/script></body></html>'></iframe>
                        <div class="slide-content">
                             <div class="slide-title-group">
                                 <h1>WIKD Cooling Fan</h1>
                                 <a href="/products/wikd-motorsports-fan-shroud-for-c7-corvette" class="btn"><span>Shop Now</span></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="questionnaire-section" class="section">
            <div class="container">
                <iframe id="questionnaireFrame" class="questionnaire-iframe" title="WIKD Motorsports Build Questionnaire" loading="lazy"></iframe>
            </div>
        </section>

        <section id="packages" class="section packages-section">
            <div class="container">
                <h2 class="section-title">Performance Packages</h2>
                <div class="packages-grid">
                    <a href="/pages/corvette-c7-lt4-tuning-packages" class="package-card">
                        <img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/image_1600x.jpg?v=1732117588" alt="Corvette C7 LT4" class="package-card-bg" loading="lazy">
                        <div class="package-card-overlay">
                            <h3 class="package-card-title">Corvette C7 LT4</h3>
                            <span class="package-card-link">View Packages &rarr;</span>
                        </div>
                    </a>
                    <a href="/pages/c8-lt2-packages" class="package-card">
                        <img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/C8_Exhaust_Tuning_Packages_10c50e27-688f-4c5e-a253-f9cb872af5d3.webp?v=1750949635" alt="Corvette C8 LT2" class="package-card-bg" loading="lazy">
                        <div class="package-card-overlay">
                            <h3 class="package-card-title">Corvette C8 LT2</h3>
                            <span class="package-card-link">View Packages &rarr;</span>
                        </div>
                    </a>
                    <a href="/pages/6th-gen-camaro-tuning-packages" class="package-card">
                        <img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/ZL1.webp?v=1750443336" alt="6th Gen Camaro" class="package-card-bg" loading="lazy">
                        <div class="package-card-overlay">
                            <h3 class="package-card-title">6th Gen Camaro</h3>
                            <span class="package-card-link">View Packages &rarr;</span>
                        </div>
                    </a>
                    <a href="/pages/ct5-blackwing-tuning-packages" class="package-card">
                        <img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/DSC08715.webp?v=1740518095" alt="CTS V & CT5 V Blackwing" class="package-card-bg" loading="lazy">
                        <div class="package-card-overlay">
                            <h3 class="package-card-title">CTS/CT5-V Blackwing</h3>
                            <span class="package-card-link">View Packages &rarr;</span>
                        </div>
                    </a>
                </div>
            </div>
        </section>

        <section id="exhausts" class="section ticker-section">
            <div class="container">
                <h2 class="section-title">Titanium Racing Exhausts</h2>
            </div>
            <div class="ticker-wrap">
                <div class="ticker-move">
                    <!-- Items are duplicated for seamless loop -->
                    <a href="/products/corvette-c8-titanium-catback-2020-brushed-blue" class="exhaust-card">
                        <div class="exhaust-card-image-wrapper"><img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/IMG_4623.jpg?v=1733425432&width=1200" class="exhaust-card-bg" alt="Corvette C8 Titanium Catback" loading="lazy"></div>
                        <div class="exhaust-card-content"><h3 class="exhaust-card-title">Corvette C8 Titanium Catback 2020+ (Brushed Blue)</h3><p class="exhaust-card-price">$3,999.99</p></div>
                    </a>
                    <a href="/products/ferrari-458-italia-45l-titanium-catback-2010-2015-golden-polish" class="exhaust-card">
                        <div class="exhaust-card-image-wrapper"><img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/IMG_4415.jpg?v=1733425565&width=1200" class="exhaust-card-bg" alt="Ferrari 458 Italia Titanium Catback" loading="lazy"></div>
                        <div class="exhaust-card-content"><h3 class="exhaust-card-title">Ferrari 458 Italia 4.5L Titanium Catback (Golden Polish)</h3><p class="exhaust-card-price">$3,999.99</p></div>
                    </a>
                    <a href="/products/mclaren-720s-decat-titanium-downpipe-2018-brushed-purple" class="exhaust-card">
                        <div class="exhaust-card-image-wrapper"><img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/IMG_4559_f71fde06-0135-4c14-9064-d85084463868.jpg?v=1734125231&width=1200" class="exhaust-card-bg" alt="Mclaren 720S Decat Titanium Downpipe" loading="lazy"></div>
                        <div class="exhaust-card-content"><h3 class="exhaust-card-title">Mclaren 720S Decat Titanium Downpipe 2018+ (Brushed Purple)</h3><p class="exhaust-card-price">$3,349.99</p></div>
                    </a>
                    <a href="/products/lamborghini-huracan-evo-header-black-ceramic-coated" class="exhaust-card">
                        <div class="exhaust-card-image-wrapper"><img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/Huracan_Headers_Blk-1.png?v=1734023095&width=1200" class="exhaust-card-bg" alt="Lamborghini Huracan EVO Header" loading="lazy"></div>
                        <div class="exhaust-card-content"><h3 class="exhaust-card-title">Lamborghini Huracan EVO / Audi R8 Header (Black Ceramic Coated)</h3><p class="exhaust-card-price">$4,999.99</p></div>
                    </a>
                    <a href="/products/corvette-c8-z06-titanium-sport-exhaust-system-2023-without-valve-brushed-blue" class="exhaust-card">
                        <div class="exhaust-card-image-wrapper"><img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/1_2abafc71-96c5-49fc-8b12-a4f461d1dde7.jpg?v=1733425492&width=1200" class="exhaust-card-bg" alt="Corvette C8 Z06 Titanium Sport Exhaust" loading="lazy"></div>
                        <div class="exhaust-card-content"><h3 class="exhaust-card-title">Corvette C8 Z06 Titanium Sport Exhaust System 2023+</h3><p class="exhaust-card-price">$4,999.99</p></div>
                    </a>
                    <a href="/products/corvette-c8-titanium-catback-2020-brushed-blue" class="exhaust-card">
                        <div class="exhaust-card-image-wrapper"><img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/IMG_4623.jpg?v=1733425432&width=1200" class="exhaust-card-bg" alt="Corvette C8 Titanium Catback" loading="lazy"></div>
                        <div class="exhaust-card-content"><h3 class="exhaust-card-title">Corvette C8 Titanium Catback 2020+ (Brushed Blue)</h3><p class="exhaust-card-price">$3,999.99</p></div>
                    </a>
                    <a href="/products/ferrari-458-italia-45l-titanium-catback-2010-2015-golden-polish" class="exhaust-card">
                        <div class="exhaust-card-image-wrapper"><img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/IMG_4415.jpg?v=1733425565&width=1200" class="exhaust-card-bg" alt="Ferrari 458 Italia Titanium Catback" loading="lazy"></div>
                        <div class="exhaust-card-content"><h3 class="exhaust-card-title">Ferrari 458 Italia 4.5L Titanium Catback (Golden Polish)</h3><p class="exhaust-card-price">$3,999.99</p></div>
                    </a>
                    <a href="/products/mclaren-720s-decat-titanium-downpipe-2018-brushed-purple" class="exhaust-card">
                        <div class="exhaust-card-image-wrapper"><img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/IMG_4559_f71fde06-0135-4c14-9064-d85084463868.jpg?v=1734125231&width=1200" class="exhaust-card-bg" alt="Mclaren 720S Decat Titanium Downpipe" loading="lazy"></div>
                        <div class="exhaust-card-content"><h3 class="exhaust-card-title">Mclaren 720S Decat Titanium Downpipe 2018+ (Brushed Purple)</h3><p class="exhaust-card-price">$3,349.99</p></div>
                    </a>
                </div>
            </div>
            <div class="section-cta">
                <a href="https://www.wikdmotorsports.com/collections/exhausts" class="btn btn-primary" target="_blank"><span>See All</span></a>
            </div>
        </section>

        <section id="gallery" class="section">
            <div class="container">
                <h2 class="section-title">From The Shop</h2>
                <div class="gallery-grid">
                    <div class="gallery-item"><img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/image_1600x.jpg?v=1732117588" alt="WIKD Z06 Gallery Image 1" loading="lazy"></div>
                    <div class="gallery-item"><img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/C7_Black_Dyno_2_310640e9-af91-41ca-8554-bdc3479cb2ae_1600x.jpg?v=1732120285" alt="WIKD Z06 Gallery Image 2" loading="lazy"></div>
                    <div class="gallery-item"><img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/C7_Black_EngineBay_1_46d7c3ca-66f2-42ea-972a-9daabcca666c_1600x.jpg?v=1732120285" alt="WIKD Z06 Gallery Image 3" loading="lazy"></div>
                    <div class="gallery-item"><img src="https://cdn.shopify.com/s/files/1/0671/4635/0805/files/C7_Black_Trunk_1t_758d6f66-d172-4b2f-9e7f-af893f46d7cf_1600x.jpg?v=1732120284" alt="WIKD Z06 Gallery Image 4" loading="lazy"></div>
                </div>
                <!-- FIX: Added "Visit Gallery" button -->
                <div class="section-cta">
                    <a href="https://www.wikdmotorsports.com/pages/gallery" class="btn btn-primary" target="_blank"><span>Visit Gallery</span></a>
                </div>
            </div>
        </section>

        <!-- MAP & LOCATION SECTION -->
        <section id="location" class="section">
            <div class="container">
                <iframe id="mapFrame" class="map-iframe" title="WIKD Motorsports Location" loading="lazy"></iframe>
            </div>
        </section>
    </main>
    
    <div class="lightbox" id="lightbox">
        <div class="lightbox-content">
            <button class="lightbox-close" title="Close">&times;</button>
            <button class="lightbox-prev" title="Previous image">&lt;</button>
            <button class="lightbox-next" title="Next image">&gt;</button>
            <img src="" alt="Lightbox image" id="lightboxImg">
        </div>
    </div>
</div>

<!-- 4. JAVASCRIPT LOGIC (Required) -->
<script>
(function() {
    // This is the master initialization function. It's designed to be idempotent,
    // meaning it can be called multiple times without breaking anything. This is crucial
    // for the Shopify theme editor, which can reload sections unpredictably.
    const runWikdHomepage = function() {
        const rootElement = document.getElementById('wikd-homepage-root');

        // Guard clause: If the main container isn't in the DOM yet, stop.
        if (!rootElement) {
            return;
        }

        // Guard clause: If this script has already run successfully, stop.
        if (rootElement.classList.contains('wikd-homepage-initialized')) {
            return;
        }

        // Mark as initialized so it doesn't run again.
        rootElement.classList.add('wikd-homepage-initialized');

        // --- HERO SLIDESHOW LOGIC ---
        try {
            const slideshow = rootElement.querySelector('#slideshow');
            if (slideshow) {
                const heroWrapper = rootElement.querySelector('.hero-wrapper');
                const slides = slideshow.querySelectorAll('.slide');
                const slideThemes = Array.from(slides).map(slide => slide.dataset.theme);
                let currentIndex = 0;
                let slideInterval;

                const exhaustVideo = slideshow.querySelector('#exhaust-video');
                if (exhaustVideo) {
                    exhaustVideo.addEventListener('ended', () => {
                        exhaustVideo.dataset.played = 'true';
                    });
                }

                const showSlide = (index) => {
                    if (!slides[currentIndex] || !slides[index]) return;

                    const prevSlide = slides[currentIndex];
                    const prevVideo = prevSlide.querySelector('video.slide-background');
                    if (prevVideo) prevVideo.pause();
                    prevSlide.classList.remove('active');
                    if (slideThemes[currentIndex]) {
                        heroWrapper.classList.remove(slideThemes[currentIndex]);
                        slideshow.classList.remove(slideThemes[currentIndex]);
                    }
                    
                    currentIndex = index;
                    const newSlide = slides[index];
                    const newVideo = newSlide.querySelector('video.slide-background');
                    newSlide.classList.add('active');
                    if (slideThemes[currentIndex]) {
                        heroWrapper.classList.add(slideThemes[currentIndex]);
                        slideshow.classList.add(slideThemes[currentIndex]);
                    }
                    if (newVideo) {
                        if (newVideo.id === 'exhaust-video' && newVideo.dataset.played === 'true') {
                            // Video has played, do nothing.
                        } else {
                            newVideo.currentTime = 0;
                            newVideo.play().catch(e => console.warn("Video autoplay failed:", e));
                        }
                    }
                };

                const nextSlide = () => {
                    if (slides.length > 0) {
                        const newIndex = (currentIndex + 1) % slides.length;
                        showSlide(newIndex);
                    }
                };

                const startInterval = () => {
                    clearInterval(slideInterval);
                    slideInterval = setInterval(nextSlide, 7000);
                };
                
                if (slides.length > 0) {
                    showSlide(0);
                    startInterval();
                }
            }
        } catch (error) {
            console.error("WIKD Homepage Error in Slideshow:", error);
        }

        // --- DYNAMIC IFRAME LOADER ---
        try {
            const loadDynamicIframe = (frameId, url, isDynamicHeight) => {
                const iframe = rootElement.querySelector(`#${frameId}`);
                if (!iframe) return;

                const cacheBustedUrl = `${url}?v=${new Date().getTime()}`;

                if (isDynamicHeight) {
                    fetch(cacheBustedUrl)
                        .then(response => response.ok ? response.text() : Promise.reject(`HTTP error ${response.status}`))
                        .then(html => {
                            const styles = `<style>body,html{margin:0!important;padding:0!important;overflow:hidden!important}</style>`;
                            const scripts = `<script>try{const o=new ResizeObserver(o=>{const t=document.documentElement.offsetHeight;window.parent.postMessage({type:"resize",height:t,frameId:"${frameId}"},"*")});o.observe(document.documentElement),window.addEventListener("load",()=>{const o=document.documentElement.offsetHeight;window.parent.postMessage({type:"resize",height:o,frameId:"${frameId}"},"*");const t=()=>window.parent.postMessage({type:"snapToTop",frameId:"${frameId}"},"*");document.getElementById("nextBtn")?.addEventListener("click",t),document.getElementById("prevBtn")?.addEventListener("click",t)})}catch(o){console.error("Error in iframe scripts:",o)}<\/script>`;
                            let processedHtml = html.replace('</head>', styles + '</head>');
                            processedHtml = processedHtml.replace('</body>', scripts + '</body>');
                            iframe.srcdoc = processedHtml;
                        })
                        .catch(error => {
                            console.error(`Error fetching content for ${frameId}:`, error);
                            if(iframe.parentElement) {
                                iframe.parentElement.innerHTML = `<p style="color: var(--color-text-muted); text-align: center;">Content failed to load.</p>`;
                            }
                        });
                } else {
                    iframe.src = cacheBustedUrl;
                }
            };

            loadDynamicIframe('questionnaireFrame', 'https://raw.githack.com/WIKDMotorsports/MasterQuestionnaire/main/index.html', true);
            loadDynamicIframe('mapFrame', 'https://raw.githack.com/WIKDMotorsports/Deploy/main/MapsWidget.html', false);

            window.addEventListener('message', (event) => {
                const data = event.data;
                if (!data.type || !data.frameId) return;
                const iframe = rootElement.querySelector(`#${data.frameId}`);
                if (!iframe || !iframe.contentWindow || event.source !== iframe.contentWindow) return;

                if (data.type === 'resize' && data.height) {
                    iframe.style.height = (data.height + 5) + 'px';
                } else if (data.type === 'snapToTop') {
                    const section = iframe.closest('.section');
                    if(section) {
                        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }
            });
        } catch (error) {
            console.error("WIKD Homepage Error in Iframe Loader:", error);
        }

        // --- LIGHTBOX LOGIC ---
        try {
            const lightbox = rootElement.querySelector('#lightbox');
            if (lightbox) {
                const lightboxImg = rootElement.querySelector('#lightboxImg');
                const galleryItems = rootElement.querySelectorAll('.gallery-item');
                const images = Array.from(galleryItems).map(item => item.querySelector('img').src);
                let currentImageIndex = 0;

                const showImage = (index) => {
                    if (index >= 0 && index < images.length) {
                        currentImageIndex = index;
                        lightboxImg.src = images[currentImageIndex];
                        lightbox.classList.add('active');
                    }
                };

                galleryItems.forEach((item, index) => {
                    item.addEventListener('click', () => showImage(index));
                });

                rootElement.querySelector('.lightbox-close').addEventListener('click', () => lightbox.classList.remove('active'));
                rootElement.querySelector('.lightbox-prev').addEventListener('click', () => { if(images.length > 0) showImage((currentImageIndex - 1 + images.length) % images.length) });
                rootElement.querySelector('.lightbox-next').addEventListener('click', () => { if(images.length > 0) showImage((currentImageIndex + 1) % images.length) });
                lightbox.addEventListener('click', (e) => {
                    if (e.target === lightbox) lightbox.classList.remove('active');
                });
            }
        } catch (error) {
            console.error("WIKD Homepage Error in Lightbox:", error);
        }
    };

    // --- ROBUST INITIALIZATION ---
    // This is the new, foolproof way to run the script. It waits for the browser to be ready
    // to paint, then checks if our root element exists. If not, it waits for the next frame
    // and checks again. This is the most reliable way to handle unpredictable script loading
    // in environments like the Shopify theme editor.
    const ensureReady = () => {
        if (document.getElementById('wikd-homepage-root')) {
            runWikdHomepage();
        } else {
            requestAnimationFrame(ensureReady);
        }
    };

    // Kick off the check.
    requestAnimationFrame(ensureReady);
    
    // Also listen for Shopify's specific event for when a section is reloaded in the editor.
    document.addEventListener('shopify:section:load', () => {
        // When Shopify reloads the section, the old 'initialized' class is gone,
        // so our script will re-run correctly for the new content.
        requestAnimationFrame(ensureReady); 
    });
})();
</script>
