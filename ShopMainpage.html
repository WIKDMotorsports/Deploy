please remove the corner radii from the filter buttons on this page:

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WIKD Motorsports - Shop</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- Font Awesome for the arrow icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


    <style>
        /* --- CSS RESET & BASE STYLES --- */
        :root {
            --color-background: #0A0A0A;
            --color-text: #EAEAEA;
            --color-text-muted: #888888;
            --color-primary: #FF0000; /* True Racing Red */
            --color-primary-dark: #CC0000; 
            --color-surface: #141414;
            --color-border: #2A2A2A;
            --font-heading: 'Rajdhani', sans-serif;
            --font-body: 'Inter', sans-serif;
            --header-height: 80px;
            
            /* Define brand colors */
            --badge-color-corvette: 255, 0, 0; /* Red */
            --badge-color-ferrari: 255, 215, 0;
            --badge-color-lamborghini: 255, 140, 0;
            --badge-color-mclaren: 147, 112, 219;
            --badge-color-audi: 100, 100, 100;
            --badge-color-universal: 70, 70, 70;
            --badge-color-accessories: 70, 70, 70;
            --badge-color-default: 255, 0, 0; /* Fallback Red */
            --badge-color-ford: 0, 17, 107; 
            --badge-color-cadillac: 175, 141, 45; 
            --badge-color-chevy: 255, 0, 0; /* Red */
            --badge-color-euro-tune: 255, 140, 0; 
        }

        *, *::before, *::after { box-sizing: border-box; }
        body, h1, h2, h3, p, ul, li { margin: 0; padding: 0; }
        
        body {
            background-color: var(--color-background);
            color: var(--color-text);
            font-family: var(--font-body);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            position: relative;
        }

        /* --- PRECISE NOISE TEXTURE OVERLAY --- */
        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            
            /* The opacity controls the intensity of the grain */
            opacity: 0.08; 
            
            /* Controls how often the pattern repeats */
            background-size: 100px 100px;
            
            /* The SVG Data URI */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        img { max-width: 100%; display: block; }
        a { color: inherit; text-decoration: none; }
        ul { list-style: none; }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-heading);
            font-weight: 700;
            text-transform: uppercase;
        }

        /* --- UTILITY CLASSES --- */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* --- SHOP CONTROLS (Updated for Stack Filter) --- */
        .shop-controls {
            display: flex;
            justify-content: space-between;
            align-items: center; /* Vertically align items */
            margin-top: 50px;
            margin-bottom: 50px;
            padding: 20px;
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%);
            filter: drop-shadow(0 20px 40px rgba(0,0,0,0.8));
            position: relative;
            z-index: 50; /* Ensure menu expands over grid */
            min-height: 90px; /* Ensure space for buttons */
        }

        /* --- FILTER STACK STYLES (From Reference) --- */
        .gallery-filter-menu {
            display: flex;
            justify-content: flex-start; /* Aligned left for shop */
            align-items: center;
            flex-wrap: wrap;
            gap: 0; 
            transition: all 0.3s ease;
            position: relative;
        }
        
        /* Base Button Styles for Filter */
        .gallery-filter-menu .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-heading);
            font-weight: 700;
            text-transform: uppercase;
            background-color: #000;
            border: 2px solid var(--color-border);
            border-radius: 0;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            height: 48px;
            box-sizing: border-box;
            white-space: nowrap;
        }

        /* Stack Items (Collapsed by default) */
        .gallery-filter-menu .btn.filter-btn {
            font-size: 16px;
            color: var(--color-text-muted);
            clip-path: polygon(0 0, 100% 0, 100% 100%, 8px 100%, 0 88%);
            
            /* DEFAULT STATE: HIDDEN */
            max-width: 0;
            padding: 0;
            margin: 0;
            opacity: 0;
            border-width: 0;
            transform: translateX(-20px);
            pointer-events: none;
            
            transition: 
                max-width 0.4s cubic-bezier(0.2, 0.8, 0.2, 1),
                padding 0.4s cubic-bezier(0.2, 0.8, 0.2, 1),
                margin 0.4s cubic-bezier(0.2, 0.8, 0.2, 1),
                opacity 0.3s ease,
                transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
                border-width 0.1s ease;
        }

        /* Active button is ALWAYS visible */
        .gallery-filter-menu .btn.filter-btn.active {
            max-width: 300px;
            padding: 0 24px;
            margin: 0 0 0 10px; 
            opacity: 1;
            border-width: 2px;
            transform: translateX(0);
            pointer-events: auto;
            color: white;
            border-color: var(--color-primary);
            background-color: var(--color-primary); /* WIKD Active Style */
        }

        /* Expanded State */
        .gallery-filter-menu.expanded .btn.filter-btn {
            max-width: 200px;
            padding: 0 24px;
            margin: 6px;
            opacity: 1;
            border-width: 2px;
            transform: translateX(0);
            pointer-events: auto;
            background-color: #000; /* Reset bg for list items */
            color: var(--color-text);
            border-color: var(--color-border);
            transition-delay: calc(var(--i) * 0.03s);
        }
        
        .gallery-filter-menu.expanded .btn.filter-btn:hover,
        .gallery-filter-menu.expanded .btn.filter-btn.active {
            transition-delay: 0s;
            background-color: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }

        /* Trigger Button */
        .gallery-filter-menu .btn.trigger-btn {
            padding: 0 32px;
            opacity: 1;
            border-width: 2px;
            transform: none;
            pointer-events: auto;
            z-index: 100;
            color: white;
            border-color: var(--color-primary);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.2);
            clip-path: polygon(0 0, 100% 0, 100% 100%, 8px 100%, 0 80%);
        }
        
        .gallery-filter-menu.expanded .btn.trigger-btn {
            background-color: rgba(255, 0, 0, 0.2);
        }

        .gallery-filter-menu .btn span {
            position: relative;
            z-index: 2;
        }

        /* Button Hover Slide Effect */
        .gallery-filter-menu .btn::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--color-primary);
            z-index: 1;
            transform: translateX(-101%);
            transition: transform 0.5s cubic-bezier(0.7, 0, 0.3, 1);
        }

        .gallery-filter-menu .btn:hover::before { transform: translateX(0); }
        /* --- END FILTER STYLES --- */

        .search-bar {
            margin-left: auto; /* Push to right */
        }
        .search-bar input {
            background-color: #000;
            border: 1px solid var(--color-border);
            color: var(--color-text);
            padding: 12px 18px;
            border-radius: 0px; 
            width: 300px;
            font-family: var(--font-body);
            transition: border-color 0.3s ease;
        }
        .search-bar input:focus {
            outline: none;
            border-color: var(--color-primary);
        }
        .search-bar input::placeholder {
            color: var(--color-text-muted);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        /* --- SHOP GRID --- */
        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
            gap: 40px; 
            padding-bottom: 80px;
            min-height: 500px; /* Prevent collapse during load/filter */
        }
        
        .shop-item {
            position: relative;
            background-color: #000;
            overflow: hidden;
            border: 1px solid var(--color-border);
            /* Important: GSAP handles opacity/transform, CSS handles hover */
            display: flex;
            flex-direction: column;
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%);
            filter: drop-shadow(0 20px 40px rgba(0,0,0,0.8));
            height: 100%;
        }
        
        /* Updated to include .mobile-active for scroll detection */
        .shop-item:hover, .shop-item.mobile-active {
            transform: translateY(-5px);
            border-color: var(--color-primary);
            filter: drop-shadow(0 30px 60px rgba(0,0,0,0.9)) drop-shadow(0 0 20px rgba(255, 0, 0, 0.3));
            transition: transform 0.3s ease, border-color 0.3s ease, filter 0.3s ease;
        }
        
        .shop-item-image {
            width: 100%;
            height: 240px; 
            overflow: hidden;
            border-bottom: 1px solid var(--color-border);
            flex-shrink: 0; 
        }
        
        .shop-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease, filter 0.5s ease;
            filter: grayscale(100%) brightness(1.1); 
        }
        
        /* Updated to include .mobile-active */
        .shop-item:hover .shop-item-image img, .shop-item.mobile-active .shop-item-image img {
            transform: scale(1.05);
            filter: grayscale(0%) brightness(1.1) contrast(110%);
        }
        
        .shop-item-content {
            padding: 15px; 
            display: flex;
            flex-direction: column;
            justify-content: space-between; 
            flex-grow: 1;
            height: 100%;
        }
        
        .shop-item-title {
            font-family: var(--font-heading);
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-bottom: 4px; 
            color: white !important; 
            line-height: 1.2;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .shop-item-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-primary);
            font-family: var(--font-heading);
            margin-top: 0; 
        }
        
        .shop-item-price.explore {
            text-transform: uppercase;
            font-size: 1.1rem;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        /* Updated to include .mobile-active */
        .shop-item:hover .shop-item-price.explore, .shop-item.mobile-active .shop-item-price.explore {
            color: white;
        }


        /* --- PRODUCT BADGE STYLES --- */
        .product-badge {
            position: absolute;
            top: 15px;
            left: -1px;
            z-index: 10;
            padding: 6px 15px 6px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700; 
            text-transform: uppercase;
            font-size: 12px;
            color: #FFFFFF;
            letter-spacing: 1px;
            border: 1px solid rgba(255,255,255,0.2);
            clip-path: polygon(0 0, 100% 0, 100% 100%, 8px 100%, 0 75%);
        }

        .badge-corvette { background-color: rgba(var(--badge-color-corvette), 0.9); }
        .badge-ferrari { background-color: rgba(var(--badge-color-ferrari), 0.9); color: black; } 
        .badge-lamborghini { background-color: rgba(var(--badge-color-lamborghini), 0.9); color: black; } 
        .badge-mclaren { background-color: rgba(var(--badge-color-mclaren), 0.9); }
        .badge-audi { background-color: rgba(var(--badge-color-audi), 0.9); }
        .badge-universal { background-color: rgba(var(--badge-color-universal), 0.9); }
        .badge-accessories, .badge-uncategorized { background-color: rgba(var(--badge-color-accessories), 0.9); }
        .badge-ford { background-color: rgba(var(--badge-color-ford), 0.9); } 
        .badge-cadillac { background-color: rgba(var(--badge-color-cadillac), 0.9); } 
        .badge-chevy { background-color: rgba(var(--badge-color-chevy), 0.9); } 
        .badge-euro-tune { background-color: rgba(var(--badge-color-euro-tune), 0.9); color: black; }


        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 900px) {
            .shop-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 20px;
            }
            /* Set the order for mobile layout */
            .search-bar {
                order: 0; /* Place the search bar first */
            }
            .gallery-filter-menu {
                order: 1; /* Place the filter menu second */
                justify-content: center;
            }
            
            .search-bar, .search-bar input {
                width: 100%;
            }
        }

        .spinner-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 50px;
            grid-column: 1 / -1;
        }
        .spinner {
            border: 4px solid var(--color-border);
            border-top: 4px solid var(--color-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>

    <!-- The overlay element -->
    <div class="noise-overlay"></div>

    <main>
        <div class="container">
            <section class="shop-controls">
                
                <!-- NEW STACK FILTER MENU -->
                <nav class="gallery-filter-menu" id="shopFilter">
                    <!-- Trigger Button -->
                    <button class="btn trigger-btn" id="filterTrigger"><span>FILTER</span></button>
                    
                    <!-- Dynamic buttons will be injected here -->
                    <div id="dynamic-filter-container" style="display: contents;"></div>
                </nav>

                <div class="search-bar">
                    <input type="text" id="search-input" placeholder="Search products...">
                </div>
            </section>

            <div class="shop-grid" id="shop-grid">
                <!-- Products will be loaded here -->
                    <div class="spinner-container" id="spinner">
                        <div class="spinner"></div>
                    </div>
            </div>
        </div>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const shopGrid = document.getElementById('shop-grid');
        const searchInput = document.getElementById('search-input');
        const spinner = document.getElementById('spinner');
        
        // Filter Elements
        const filterMenu = document.getElementById('shopFilter');
        const triggerBtn = document.getElementById('filterTrigger');
        const filterContainer = document.getElementById('dynamic-filter-container');
        let isExpanded = false;
        
        let mobileObserver; // Store observer instance

        // --- MOBILE SCROLL EFFECT LOGIC ---
        function initMobileObserver() {
            const options = {
                root: null,
                // Center 20% of the screen is the "hot zone" (-40% top offset, -40% bottom offset)
                rootMargin: "-40% 0px -40% 0px", 
                threshold: 0
            };

            mobileObserver = new IntersectionObserver((entries) => {
                // Only apply on mobile screens (approx < 900px to match CSS breakpoint)
                if (window.innerWidth > 900) return;

                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('mobile-active');
                    } else {
                        entry.target.classList.remove('mobile-active');
                    }
                });
            }, options);
        }

        function updateMobileObservation() {
            if (!mobileObserver) return;
            // Disconnect old observations (good for hygiene when refiltering)
            mobileObserver.disconnect(); 
            
            const items = document.querySelectorAll('.shop-item');
            items.forEach(item => mobileObserver.observe(item));
        }
        
        // Clean up mobile active states on resize to desktop
        window.addEventListener('resize', () => {
            if (window.innerWidth > 900) {
                document.querySelectorAll('.mobile-active').forEach(el => el.classList.remove('mobile-active'));
            }
        });

        // Initialize once
        initMobileObserver();


        const jsonUrl = 'https://cdn.shopify.com/s/files/1/0671/4635/0805/files/shoponly.json?v=1760970186'; 
        let allProducts = [];

        // --- FETCH DATA & INITIALIZE ---
        async function fetchProducts() {
            try {
                const response = await fetch(jsonUrl);
                if (!response.ok) throw new Error('Network error');
                const data = await response.json();
                
                // Titles to ignore (same as before)
                const titlesToRemove = [
                    'Lamborghini Huracan EVO Header / Audi R8 (Golden Ceramic Coated)',
                    'Lamborghini Huracan EVO / Audi R8 Header (Black Ceramic Coated)',
                    'Universal 16" Fan Shroud (C7/Universal)',
                    '16" SPAL Fan (High Performance)',
                    'WIKD Motorsports - Fan & Shroud for C7 Corvette', 
                    'WIKD Motorsports - Universal 18in Fan & Shroud', 
                    '570S & 720S Titanium Exhaust Tips (Black)',
                    '570S & 720S Titanium Exhaust Tips (Brushed Purple Finish)',
                    '570S & 720S Titanium Exhaust Tips Style 1',
                    '570S & 720S Titanium Exhaust Tips Style 2',
                    '570S & 720S Titanium Exhaust Tips (Inner Purple Finish)', 
                    'WIKD Tuned Sticker', 
                    'GET WIKD Jet Tag - WIKD', 
                    'Custom License Plate Frames'
                ];
                const titlesToRemoveUpper = new Set(titlesToRemove.map(t => t.toUpperCase()));
                
                // --- MAP PRODUCTS ---
                // Reusing the mapping logic from previous file, but optimized for brevity
                // Note: I'm condensing the data processing here for code efficiency
                allProducts = data.shop
                    .filter(item => !titlesToRemoveUpper.has(item.title.toUpperCase()))
                    .map(item => processProductItem(item));
                
                // Add Manual Entries (same array as before)
                addManualEntries(allProducts);

                // Initial Sort
                sortProducts(allProducts);

                // 1. Create Filter Buttons (Stack)
                populateFilterStack(allProducts);
                
                // 2. Render All Items initially
                renderShopItems(allProducts);

                // 3. Initialize Filter Logic
                initFilterLogic();

            } catch (error) {
                console.error("Error:", error);
                shopGrid.innerHTML = `<p style="color: var(--color-primary); grid-column: 1/-1; text-align: center;">Error loading products.</p>`;
            } finally {
                spinner.style.display = 'none';
            }
        }

        // --- HELPER: Process Data ---
        function processProductItem(item) {
             let link = item.link || '#product-detail';
             // Simple fallback logic
             if (link === 'https://www.wikdmotorsports.com/pages/shop') {
                const slug = item.title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-*|-*$/g, '');
                link = `/products/${slug}`;
             }
             
             // Infer categories/make
             if (!item.categories) item.categories = ['accessories'];
             if (!Array.isArray(item.categories)) item.categories = [item.categories];
             
             let make = 'accessories';
             let t = item.title.toLowerCase();
             if (t.includes('corvette') || t.includes('c8') || t.includes('c7')) make = 'corvette';
             else if (t.includes('camaro') || t.includes('zl1')) make = 'chevy';
             else if (t.includes('ct5') || t.includes('cts-v')) make = 'cadillac';
             else if (t.includes('ford') || t.includes('f450')) make = 'ford';
             else if (t.includes('lamborghini') || t.includes('huracan') || t.includes('r8')) make = 'lamborghini';
             else if (t.includes('ferrari') || t.includes('458')) make = 'ferrari';
             else if (t.includes('mclaren')) make = 'mclaren';
             
             return { ...item, link, make, categories: item.categories.map(c=>c.toLowerCase()) };
        }

        function addManualEntries(products) {
            // (Re-inserting the manual entries array for completeness)
             const manualEntries = [
                { title: 'Lamborghini Huracan EVO / Audi R8 Header (Black Ceramic Coated)', price: 4999.99, make: 'lamborghini', link: 'https://www.wikdmotorsports.com/pages/r8-huracan-header', image: { src: 'https://www.wikdmotorsports.com/cdn/shop/files/Huracan_Headers_Blk-1.png?v=1734023095&width=800', alt: 'Lamborghini Header' } },
                { title: 'European Custom ECU Tuning', price: 0, make: 'euro-tune', isEuroTune: true, link: 'https://www.wikdmotorsports.com/pages/euro-tune', image: { src: 'https://cdn.shopify.com/s/files/1/0671/4635/0805/files/huracan.png?v=1760449069', alt: 'Euro Tune' } },
                { title: 'WIKD Modular Exhaust Tips (Multiple Styles)', price: 149.99, make: 'modular-tips', isModularTips: true, link: '#', image: { src: 'https://www.wikdmotorsports.com/cdn/shop/files/DSC_1817.jpg?v=1734029625&width=800', alt: 'Tips' } },
                { title: 'Ford F450 Wheel and Tire Package', price: 8799.00, make: 'ford', link: 'https://www.wikdmotorsports.com/pages/f450-wheel-tire-package', image: { src: 'https://cdn.shopify.com/s/files/1/0671/4635/0805/files/wmremove-transformed_0_00_00_00_a1b41fae-fb45-4e22-9cc6-486322db3322.png?v=1759764806', alt: 'Ford F450' } },
                { title: 'Corvette C8 LT2 Tuning Packages', price: 5000.00, make: 'corvette', link: 'https://www.wikdmotorsports.com/pages/c8-lt2-packages', image: { src: 'https://cdn.shopify.com/s/files/1/0671/4635/0805/files/C8.jpg?v=1758055597', alt: 'C8 Tuning' } },
                { title: 'CT5 Blackwing Tuning Packages', price: 4500.00, make: 'cadillac', link: 'https://www.wikdmotorsports.com/pages/ct5-blackwing-tuning-packages', image: { src: 'https://cdn.shopify.com/s/files/1/0671/4635/0805/files/BW.jpg?v=1758055597', alt: 'CT5 Tuning' } },
                { title: 'Cadillac CTS-V Tuning Packages', price: 3335.00, make: 'cadillac', link: 'https://www.wikdmotorsports.com/pages/cts-v-tuning-packages', image: { src: 'https://cdn.shopify.com/s/files/1/0671/4635/0805/files/CTS-V-FX.jpg?v=1758052426', alt: 'CTS-V Tuning' } },
                { title: 'ZL1 Camaro 6th Gen Tuning Packages', price: 2600.00, make: 'chevy', link: 'https://www.wikdmotorsports.com/pages/6th-gen-camaro-tuning-packages', image: { src: 'https://cdn.shopify.com/s/files/1/0671/4635/0805/files/ZL1_2259f36d-ac38-4e8e-aa56-044cd86ff865.jpg?v=1758055597', alt: 'ZL1 Tuning' } },
                { title: 'Corvette C7 LT4 Tuning Packages', price: 2500.00, make: 'corvette', link: 'https://www.wikdmotorsports.com/pages/corvette-c7-lt4-tuning-packages', image: { src: 'https://cdn.shopify.com/s/files/1/0671/4635/0805/files/C7.jpg?v=1758055598', alt: 'C7 Tuning' } },
                { title: 'WIKD Universal & C7 Fan Shroud Kits', price: 1099.99, make: 'universal', link: 'https://www.wikdmotorsports.com/pages/wikd-fan-universal-c7', image: { src: 'https://www.wikdmotorsports.com/cdn/shop/files/dsc08287_1.jpg?v=1734036302&width=800', alt: 'Fan Shroud' } },
                { title: 'WIKD Merch', price: 0, make: 'accessories', isMerchCard: true, link: 'https://www.wikdmotorsports.com/pages/merch', image: { src: 'https://www.wikdmotorsports.com/cdn/shop/files/GET_WIKD_Jet_Tag_-_WIKD.jpg?v=1745934173&width=800', alt: 'WIKD Merch' } }
            ];
            products.push(...manualEntries);
        }

        function sortProducts(products) {
            products.sort((a, b) => {
                if(a.isEuroTune || a.isModularTips) return -1;
                if(b.isEuroTune || b.isModularTips) return 1;
                if(a.isMerchCard) return 1;
                if(b.isMerchCard) return -1;
                return parseFloat(b.price) - parseFloat(a.price);
            });
        }

        // --- NEW FILTER STACK LOGIC ---
        function populateFilterStack(products) {
            const makes = new Set(['all']);
            products.forEach(p => makes.add(p.make));
            
            const cleanedMakes = Array.from(makes)
                .map(make => make === 'accessories' ? 'merchandise' : make)
                .filter(make => !['uncategorized', 'euro-tune', 'modular-tips'].includes(make))
                .sort();
            
            // Re-add 'all' at the beginning
            const finalMakes = ['all', ...cleanedMakes.filter(m => m !== 'all')];

            filterContainer.innerHTML = '';
            
            finalMakes.forEach((make, index) => {
                const btn = document.createElement('button');
                btn.className = `btn filter-btn ${make === 'all' ? 'active' : ''}`;
                btn.dataset.filter = make;
                // Add index style for staggered animation
                btn.style.setProperty('--i', index);
                
                const span = document.createElement('span');
                span.textContent = make.toUpperCase();
                btn.appendChild(span);
                
                filterContainer.appendChild(btn);
            });
        }

        function initFilterLogic() {
            // Toggle Menu
            triggerBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleMenu();
            });

            // Handle Filter Selection
            filterMenu.addEventListener('click', (e) => {
                const target = e.target.closest('.filter-btn');
                if (!target) return;

                if (isExpanded) {
                    // Update Active State
                    const currentActive = filterMenu.querySelector('.filter-btn.active');
                    if (currentActive) currentActive.classList.remove('active');
                    target.classList.add('active');

                    // Run Filtering
                    const filterValue = target.dataset.filter;
                    applyGSAPFilter(filterValue);

                    toggleMenu(); // Close after select
                } else {
                    // If collapsed, open the menu
                    toggleMenu();
                }
            });
        }

        function toggleMenu() {
            isExpanded = !isExpanded;
            if (isExpanded) {
                filterMenu.classList.add('expanded');
                triggerBtn.querySelector('span').textContent = 'CLOSE';
            } else {
                filterMenu.classList.remove('expanded');
                triggerBtn.querySelector('span').textContent = 'FILTER';
            }
        }

        // --- GSAP FILTERING IMPLEMENTATION ---
        function applyGSAPFilter(filter) {
            // Include search term in filtering logic
            const searchTerm = searchInput.value.toLowerCase();
            const shopItems = gsap.utils.toArray('.shop-item');
            
            const itemsToHide = [];
            const itemsToShow = [];

            shopItems.forEach(item => {
                const itemMake = item.dataset.make;
                const itemTitle = item.dataset.title; // Need to add this in render
                
                // 1. Check Make Filter
                let matchesFilter = false;
                if (filter === 'all') {
                    matchesFilter = true;
                } else if (filter === 'merchandise') {
                     if (itemMake === 'accessories') matchesFilter = true;
                } else if (filter === 'euro-tune') {
                     if (['lamborghini', 'ferrari', 'mclaren'].includes(itemMake)) matchesFilter = true;
                } else {
                     if (itemMake === filter) matchesFilter = true;
                }
                
                // Special Card Logic preservation
                if (filter === 'all') {
                     // Ensure special cards show up
                     // (Already handled by data-make assignment in render)
                }

                // 2. Check Search Term
                let matchesSearch = true;
                if (searchTerm) {
                    matchesSearch = itemTitle.includes(searchTerm) || itemMake.includes(searchTerm);
                }

                if (matchesFilter && matchesSearch) {
                    itemsToShow.push(item);
                } else {
                    itemsToHide.push(item);
                }
            });

            // GSAP Timeline for smooth transition
            const tl = gsap.timeline();

            if (itemsToHide.length > 0) {
                tl.to(itemsToHide, {
                    opacity: 0,
                    scale: 0.9,
                    duration: 0.3,
                    stagger: 0.05,
                    ease: 'power3.in',
                    onComplete: () => {
                        itemsToHide.forEach(el => el.style.display = 'none');
                    }
                });
            }

            if (itemsToShow.length > 0) {
                itemsToShow.forEach(el => {
                    el.style.display = 'flex'; // Restore display
                    gsap.set(el, { opacity: 0, scale: 0.9 });
                });

                tl.to(itemsToShow, {
                    opacity: 1,
                    scale: 1,
                    duration: 0.4,
                    stagger: 0.05,
                    ease: 'power3.out'
                }, itemsToHide.length > 0 ? ">-0.1" : 0);
            }
        }

        // Search Input Listener to trigger GSAP filter
        searchInput.addEventListener('input', () => {
            const activeBtn = filterMenu.querySelector('.filter-btn.active');
            const currentFilter = activeBtn ? activeBtn.dataset.filter : 'all';
            applyGSAPFilter(currentFilter);
        });

        // --- RENDER DOM ---
        function renderShopItems(products) {
            shopGrid.innerHTML = '';
            
            products.forEach(item => {
                const shopItem = document.createElement('a');
                shopItem.className = 'shop-item';
                shopItem.href = item.link;
                
                // Add Data Attributes for GSAP Filtering
                shopItem.dataset.make = item.make;
                shopItem.dataset.title = item.title.toLowerCase();

                // ... (Badge Logic - Condensed) ...
                let badgeHtml = '';
                const m = item.make;
                if (!['accessories','uncategorized','universal','euro-tune','modular-tips'].includes(m)) {
                     badgeHtml = `<div class="product-badge badge-${m.toLowerCase().replace(/\s/g,'-')}">${m.toUpperCase()}</div>`;
                }
                
                // Special Badge Overrides
                if (item.isEuroTune) badgeHtml = `<div class="product-badge badge-euro-tune">EUROPEAN</div>`;
                if (item.isModularTips) badgeHtml = `<div class="product-badge badge-universal">MODULAR</div>`;
                if (item.isMerchCard) badgeHtml = `<div class="product-badge badge-accessories">MERCHANDISE</div>`;

                // Price Logic
                let priceHtml;
                if (item.isEuroTune) priceHtml = `<p class="shop-item-price explore">EXPLORE TUNING &nbsp;<i class="fas fa-arrow-right"></i></p>`;
                else if (item.isMerchCard) priceHtml = `<p class="shop-item-price explore">EXPLORE MERCH &nbsp;<i class="fas fa-arrow-right"></i></p>`;
                else {
                    const pVal = parseFloat(item.price);
                    const pText = isNaN(pVal) || pVal === 0 ? 'N/A' : (item.title.toLowerCase().includes('package') ? `Starting at $${pVal.toFixed(2).replace(/\.00$/, '')}` : `$${pVal.toFixed(2)}`);
                    priceHtml = `<p class="shop-item-price">${pText}</p>`;
                }

                // Image Logic
                const imgUrl = item.image?.src || 'https://placehold.co/300x300/141414/eaeaea?text=Image+Unavailable';
                
                let title = item.title.replace(/\s*\(Starting Price\)\s*/i, '').trim();

                shopItem.innerHTML = `
                    ${badgeHtml}
                    <div class="shop-item-image">
                        <img src="${imgUrl}" alt="${title}" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/300x300/141414/eaeaea?text=Image+Error';">
                    </div>
                    <div class="shop-item-content">
                        <h3 class="shop-item-title">${title}</h3>
                        ${priceHtml}
                    </div>
                `;
                shopGrid.appendChild(shopItem);
            });
            
            // Re-attach observer to new elements
            updateMobileObservation();
        }

        // Initial Fetch
        fetchProducts();
    });
    </script>
</body>
</html>

make the minimum necessary changes to result in desired output. make no other alterations. act as a senior developer. return full final code in canvas. DO NOT EDIT THE CLIP. ONLY REMOVE THE ROUNDNESS OF THE OTHER CORNERS JESUS FUCK
